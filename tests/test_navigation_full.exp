#!/usr/bin/expect -f
# Test all pane navigation including 4 and 5

set timeout 10

# Cleanup function
proc cleanup_terminal {} {
    catch {exec printf "\033\[?1000l\033\[?1003l\033\[?1015l\033\[?1006l\033\[?25h"}
}

# Start the application
spawn llm-manager

# Wait for app to start
expect {
    timeout { puts "ERROR: App failed to start"; exit 1 }
    "LLM Manager" { puts "✓ App started" }
}

# Give it time to fully render
sleep 1

# Test navigation to all 5 panes
puts "\n→ Testing pane 1 (User Prompt)..."
send "1"
sleep 0.5

puts "→ Testing pane 2 (System Prompt)..."
send "2"
sleep 0.5

puts "→ Testing pane 3 (Context)..."
send "3"
sleep 0.5

puts "→ Testing pane 4 (LLM Selection)..."
send "4"
sleep 0.5
expect {
    timeout { puts "⚠ No notification for pane 4" }
    -re "(Focused|LLM)" { puts "✓ Pane 4 works" }
}

puts "→ Testing pane 5 (Response)..."
send "5"
sleep 0.5
expect {
    timeout { puts "⚠ No notification for pane 5" }
    -re "(Focused|Response)" { puts "✓ Pane 5 works" }
}

# Test going back to pane 1
puts "→ Testing back to pane 1..."
send "1"
sleep 0.5

# Quit
puts "→ Quitting..."
send "q"
expect eof
wait

cleanup_terminal
puts "\n✓ Navigation test complete"
exit 0
